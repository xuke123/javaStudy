# 内存淘汰策略

## 内存淘汰

- noeviction(默认策略):对于写请求不再提供服务,直接返回错误
- allkeys-lru:从所有key中使用LRU算法淘汰
- volatile-lru: 对设置过过期时间key使用LRU算法淘汰
- allkeys-random: 对所有key随机淘汰数据
- volatile-random: 对设置过期时间key随机淘汰
- volatile-ttl:设置过期key中,根据key过期时间进行淘汰,越早过期越早被淘汰

## LRU算法

Redis使用近似LRU算法,通过每次随机采样法淘汰数据,每次随机采样n个key,从中淘汰最少使用的key

为此,redis为每个key增加一个额外24bit字段,用来存储该key最后一次被访问的时间

redis3.0 维护一个候选池(大小16),池中数据根据访问时间排序,每一次随机选取的key都会放在池中,随后每次随机选取的key只有在访问时间小于池中最小的时间才会放入池中，直到候选池被放满。当放满后，如果有新的key需要放入，则将池中最后访问时间最大（最近被访问）的移除。
当需要淘汰的时候，则直接从池中选取最近访问时间最小（最久没被访问）的key淘汰掉就行。

## LFU算法

Redis4.0 它的核心思想是根据key的最近被访问的频率进行淘汰，很少被访问的优先被淘汰，被访问的多的则被留下来。

volatile-lfu：在设置了过期时间的key中使用LFU算法淘汰key
allkeys-lfu：在所有的key中使用LFU算法淘汰数据