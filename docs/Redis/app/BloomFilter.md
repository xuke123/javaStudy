# [布隆过滤器](https://www.jianshu.com/p/e4773b69319d)

## 概述

一种多hash函数映射的快速查找算法,通常应用在一些需要快速判断某个元素是否属于集合,但不保证100% 正确的场景

元素不在集合那么元素就一定不在集合,如果判断在集合中,那么就可能存在误判

## 优缺点

节省空间,空间效率和查询时间远超一般算法,但是存在误识别率和删除困难

## 应用

主要用布隆过滤器减少磁盘io和网络请求

1. 黑名单

   邮件黑名单过滤器,判断邮件地址是否在黑名单中

2. 网络爬虫去重

3. KV系统快速判断某个key是否存在
   - 例如Hbase每个region都含有一个BloomFilter,用于快速判断key在该region是否存在
4. 缓解缓存击穿
   - 大量查询不存在数据的请求时,越过redis缓存后,全部打到数据库中
   - 可以在服务器内存中搭建布隆过滤器进行缓解

## 去重背景

1. 数据直接存在在数据库中
   - 查询效率低
2. 使用HashSet/redis的set数据存储起来,实现O(1)时间复杂度查询
   - 占用空间较大
3. 经过MD5或者SHA-1等,单向哈希后再保存到HashSet或数据库
   - 由于字符串经过MD5或SHA-1处理后，长度只有128bit或160bit，所以当数据本身长度较大时，比方法2节省内存。
4. BitMap 建立一个BitSet,将每份数据通过hash函数映射到某一个(bit)
   - 消耗内存少，但单一哈希函数发生冲突的概率太高。若要冲突率降到1%，就要将Bitset的长度设置为数据个数的100倍。

## 生产环境应用

Redis 因其支持 setbit 和 getbit 操作，且纯内存性能高等特点，因此天然就可以作为布隆过滤器来使用。可以通过redis实现分布式的持久化去重。但是需要注意redis的bitmap是用字符串来实现的，而redis规定字符串最长为512MB（40多亿位），因此生产环境中建议对体积庞大的布隆过滤器进行拆分

## 题外话

部K-V数据库（Redis、HBase之类）存储需要去重的键

## 海量数据去重

1. 根据一定规则分层去重
2. 主键去重
3. set去重


