# 概述
  
优化措施:查询优化,索引优化,库表结构优化

## 主要原因主要是两部分

  1. 是否检索大量超过需要的数据
  2. 是否分析大量超过需要的数据行

## 优化数据访问

* 向数据库请求了不需要数据
  
  1. 查询不需要的记录,办法是使用limit
  2. 多表关联时返回全部列
  3. 总是取出所有列,尽量避免select *
  4. 重复查询相同的数据:加缓存

* 扫描额外的记录
  
  主要指标
  1. 响应时间 排队时间和服务时间
  2. 扫描行数
  3. 返回行数

  应用where条件
  1. 在索引中使用where ,此层在存储引擎层
  2. 使用覆盖索引,直接在索引中过滤不需要结果,无需回表
  3. 在SQL服务层过滤不满足条件数据

  手段
  1. 使用覆盖索引
  2. 改变库表结构
  3. 重写复杂查询,让优化器进一步优化

## 重构查询方式

* 可将一个查询改成多个小查询
* 切分查询
* 分解关联查询
  1. 缓存效率更高
  2. 查询分解,执行单个查询可减少锁竞争
  3. 数据库拆分更容易,拓展性更好
  4. 对查询效率也有所提升,例如使用in代替关联查询
  5. 可以减少冗余记录查询,做关联时可能会重复访问一部分数据
  6. 相关于在应用层做了哈希关联,而不是mysql嵌套关联

## 查询执行基础
  
  ![概述图](https://raw.githubusercontent.com/xuke123/tuChuang/master/20200707000454.png)

* 客户端.服务器通信协议
  
  1. 半双工,无法终止(limit必要性)
  2. 查询状态(sleep,Query,
  LOCKED,AnalyzingAndStatistics,copying to tmp table[on disk],sorting result,sending data)
  3. 查询缓存
  4. 查询优化处理
  5. 查询执行引擎

    根据执行计划,调用存储引擎,获得相应数据
  6. 返回结果给客户端

    增量,逐步返回的过程,服务器无须存储太多结果
